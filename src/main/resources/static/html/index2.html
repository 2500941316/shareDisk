<!DOCTYPE html>
<html lang='en' class='no-js'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <title>上海大学资源共享平台</title>
    <meta name='description' content=''/>
    <meta name='keywords' content=''/>
    <meta name='author' content='Themesdesign'/>

    <link rel='shortcut icon' href='../images/favicon.ico'>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" type="text/css" href="../css/webuploader.css">
    <link rel='stylesheet' href='../css/bootstrap.min.css' type='text/css'>
    <link rel="stylesheet" href="../js/layui/css/layui.css" media="all">
    <!--Material Icon -->
    <link rel='stylesheet' type='text/css' href='../css/materialdesignicons.min.css'/>

    <link rel='stylesheet' type='text/css' href='../css/fontawesome.css'/>
    <link rel="stylesheet" href="../css/layuiMy.css" media="all">
    <!-- selectize css -->
    <link rel='stylesheet' type='text/css' href='../css/selectize.css'/>
    <link rel='stylesheet' href='../css/webuploader.css'/>
    <!--Slider-->
    <link rel='stylesheet' href='../css/owl.carousel.css'/>
    <link rel='stylesheet' href='../css/owl.theme.css'/>
    <link rel='stylesheet' href='../css/owl.transitions.css'/>

    <!-- Custom  Css -->
    <link rel='stylesheet' type='text/css' href='../css/style.css'/>

</head>

<body>
<!-- Loader -->
<div id='preloader'>
    <div id='status'>
        <div class='spinner'>
            <div class='double-bounce1'></div>
            <div class='double-bounce2'></div>
        </div>
    </div>
</div>
<!-- Loader -->

<!-- Navigation Bar-->
<header id='topnav' class='defaultscroll scroll-active'>
    <!-- Tagline STart -->
    <div class='tagline'>
        <div class='container'>
            <div class='float-left'>
                <div class='phone'>
                    <i class='mdi mdi-phone-classic'></i> 17750905812
                </div>
                <div class='email'>
                    <a href='#'>
                        <i class='mdi mdi-email'></i> 2500941316@qq.com
                    </a>
                </div>
            </div>
            <div class='float-right'>
                <ul class='topbar-list list-unstyled d-flex' style='margin: 11px 0px;'>
                    <li class='list-inline-item'><a href='javascript:void(0);'><i class='mdi mdi-account mr-2'></i>19721631</a>
                    </li>
                    <li class='list-inline-item'><a href='/logout'><i class='mdi mdi-account mr-2'></i>注销</a></li>
                </ul>
            </div>
            <div class='clearfix'></div>
        </div>
    </div>
    <!-- Tagline End -->

    <!-- Menu Start -->
    <div class='container'>
        <!-- Logo container-->
        <div>
            <a href='index.html' class='logo'>

            </a>
        </div>
        <div class='buy-button'>
            <button href='#' onclick="openProductCount()" class='btn btn-primary'><i class='mdi mdi-cloud-upload'></i>
                上传文件
            </button>
        </div><!--end login button-->
        <!-- End Logo container-->
        <div class='menu-extras'>
            <div class='menu-item'>
                <!-- Mobile menu toggle-->
                <a class='navbar-toggle'>
                    <div class='lines'>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </a>
                <!-- End mobile menu toggle-->
            </div>
        </div>

        <div id='navigation'>
            <!-- Navigation Menu-->
            <ul class='navigation-menu' style='margin-left: 120px'>
                <li><a href='index.html'>主页</a></li>
                <li class='has-submenu'>
                    <a href='../index.html'>我的文件</a>
                </li>

                <li class='has-submenu'>
                    <a href='group.html'>共享文件</a>
                </li>


            </ul><!--end navigation menu-->
        </div><!--end navigation-->
    </div><!--end container-->
    <!--end end-->
</header><!--end header-->
<!-- Navbar End -->

<!-- Start Home -->

<section class='bg-home'>
    <div class='bg-overlay'></div>
    <div class='home-center'>
        <div class='home-desc-center'>
            <div class='container'>
                <div class='row justify-content-center'>
                    <div class='col-lg-12'>
                        <div class='title-heading text-center text-white'>

                            <h1 class='heading font-weight-bold mb-4'>上海大学资源共享平台</h1>
                            <h6 class='small-title text-uppercase text-light mb-3'>Shanghai University Resource Sharing
                                Platform</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- end home -->


<!--弹出框中的内容-->
<div id="upload-list" style="display: none">
    <div class="page">
        <div class="file-panel">
            <div id="test">
                <button type="button" class="layui-btn" style="margin: 3px">点击上传</button>
            </div>
            <hr>

            <div class="file-list" id="fileList"></div>
        </div>
    </div>
</div>
<button id="picker" style="display: none;">点击上传文件</button>


<!-- javascript -->
<script language="javascript" src="../index.html"></script>
<script src='../js/jquery.min.js'></script>
<script src='../js/plugins.js'></script>
<script src='../js/webuploader.min.js'></script>
<!-- selectize js -->
<script src='../js/selectize.min.js'></script>
<script src='../js/jquery.nice-select.min.js'></script>

<script src='../js/PicPeak.js'></script>
<script src='../js/layui/layui.js'></script>
<script src='../js/iconfont.js'></script>
<script src='../js/owl.carousel.min.js'></script>
<script src='../js/app.js'></script>
<script src='../js/home.js'></script>

<script>

    //在上传列表中移除file
    function remove(file) {
        // 取消并中断文件上传
        uploader.cancelFile(file);
        // 在队列中移除文件
        uploader.removeFile(file, true);
        // 在ui上移除
        var list=document.getElementById("fileId-" + file.id);
        list.remove();
    }

    //文件大小转换
    function bytesToSize(bytes) {
        if (bytes === 0) return "0 B";
        var k = 1024;
        var sizes = ["B", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"];
        var i = Math.floor(Math.log(bytes) / Math.log(k));
        return (bytes / Math.pow(k, i)).toPrecision(3) + " " + sizes[i];
    }


    function openProductCount() {
        layui.use(['form'], function () {
            var layer = layui.layer;
            layer.open({
                type: 1,
                title: '上传文件',
                area: ['700px', '617px'], //宽高
                content: $('#upload-list'),

            });
        });
    }

    function remove1(s)
    {
        console.log(s);
    }

    $('#test').click(function (event) {
        $("#picker").find('input').click();
    });
    var uploader = WebUploader.create({
        auto: true,// 选完文件后，是否自动上传。
        swf: 'images/Uploader.swf',// swf文件路径
        server: 'uploadToBacken',// 文件接收服务端。
        pick: '#picker',// 内部根据当前运行是创建，可能是input元素，也可能是flash. 这里是div的id
        multiple: true, // 选择多个
        chunked: true,// 开起分片上传。
        threads: 5, // 上传并发数。允许同时最大上传进程数。
        method: 'POST', // 文件上传方式，POST或者GET。
        fileSizeLimit: 1024 * 1024 * 100 * 100, //验证文件总大小是否超出限制, 超出则不允许加入队列。
        fileSingleSizeLimit: 1024 * 1024 * 1024 * 3, //验证单个文件大小是否超出限制, 超出则不允许加入队列。
        formData: {
            backId: ""
        }
    });

    uploader.on('fileQueued', function (file) {
        // 选中文件时要做的事情，比如在页面中显示选中的文件并添加到文件列表，获取文件的大小，文件类型等
        var fileSize = bytesToSize(file.size);
        var html = '<ul id="fileId-' + file.id + '" class="file-item"><li class="file-type"></li>   ' +
            '                             <li class="file-name">' + file.name + '</li>' +
            '                             <li class="file-size">' + fileSize + '</li>  ' +
            '                             <li id="status-' + file.id + '" class="file-status">上传中...</li>  ' +
            '                             <li onclick="remove1('+file+')" class="file-operate">' +
            '                        <div   class="layui-btn-group">' +
            '                            <button type="button"   class="layui-btn layui-btn-sm"><i class="layui-icon"></i></button>' +
            '                        </div>' +
            '                    </li>' +
            '                    <li id="progress-' + file.id + '" class="progress"></li></ul>';
        $('#fileList').append(html);
    });

    uploader.on("uploadStart", function () {
        // 在这里可以准备好formData的数据
        var backId = localStorage.getItem("backId");
        if (backId == "00000000") {
            backId = localStorage.getItem("username");
        }
        uploader.options.formData.backId = "19721631";
    });

    uploader.on('uploadProgress', function (file, percent) {
        if (percent === 1) {
            $("#progress-" + file.id).css("width", percent * 100 + "%");
            $("#status-" + file.id).html("正在存储");
        } else {
            $("#progress-" + file.id).css("width", percent * 100 + "%");
            $("#status-" + file.id).html(
                (percent * 100).toFixed(0) + "%"
            );
        }
    });

    uploader.on('uploadSuccess', function (file, response) {
        if (response.code === 200) {
            remove(file)
            //刷新我的文件
            layer.msg(file.name+'  上传成功', {
                time: 1000
            }, function () {
                selectFile("19721631", "1");
            });
        }
    });

    uploader.on('uploadError', function (file) {
        remove(file);
        layer.msg(file.name+'  网络异常，上传失败', {
            time: 1000
        }, function () {
        });
    });

    $('#fileList').on('click', '.upload-item .btn-delete', function () {
        // 从文件队列中删除某个文件id
        file_id = $(this).data('file_id');
        // uploader.removeFile(file_id); // 标记文件状态为已取消
        uploader.removeFile(file_id, true); // 从queue中删除
        console.log(uploader.getFiles());
    });

    uploader.on('uploadComplete', function (file) {

    });


</script>

</body>
</html>